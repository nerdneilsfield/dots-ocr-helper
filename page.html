$-- Minimal Pandoc template: JS-only TOC drawer + theme switch
<!doctype html>
<html$if(lang)$ lang="$lang$"$endif$>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="color-scheme" content="light dark"/>
  $if(title)$<title>$title$</title>$else$<title>Document</title>$endif$
  $if(author-meta)$<meta name="author" content="$author-meta$"/>$endif$
  $if(date-meta)$<meta name="date" content="$date-meta$"/>$endif$
  <meta name="generator" content="pandoc"/>

  $for(css)$<link rel="stylesheet" href="$css$"/>$endfor$
  $if(highlighting-css)$<style>$highlighting-css$</style>$endif$
  $for(header-includes)$ $header-includes$ $endfor$

  <!-- ä»…è´Ÿè´£ä¸»é¢˜è¦†ç›–ï¼ˆå˜é‡ï¼‰ï¼›å…¶ä½™æ ·å¼æ”¾ style.css -->
  <style>
    html.force-dark, body.force-dark{
      --bg:#0f1115; --fg:#e7e7e7; --fg-subtle:#cfcfcf; --muted:#9aa0a6; --border:#2a2f3a;
      --brand:#ff6b66; --brand-600:#ff4b44; --brand-100:#2a1a1a;
      --code-bg:#161a22; --code-fg:#e7e7e7; --table-zebra:#151922; --quote-bar:#ff6b66;
    }
    html.force-light, body.force-light{
      --bg:#ffffff; --fg:#1f1f1f; --fg-subtle:#444; --muted:#777; --border:#e6e6e6;
      --brand:#f22f27; --brand-600:#e21f1c; --brand-100:#fff3f0;
      --code-bg:#f6f8fa; --code-fg:#24292e; --table-zebra:#fafafa; --quote-bar:#f22f27;
    }
    /* ä¸¤ä¸ªå°æŒ‰é’®çš„åŸºç¡€å¤–è§‚ï¼ˆé¿å…ä¾èµ–ä½ æ—§æ ·å¼ï¼‰ */
    .btn-fab{
      position: fixed; right: 16px; z-index: 1001;
      appearance:none; border:1px solid var(--border); background:var(--bg); color:var(--fg);
      border-radius:999px; padding:10px 14px; cursor:pointer; box-shadow:0 6px 18px rgba(0,0,0,.12);
    }
    #btn-theme{ bottom: 72px; }
    #btn-toc{ bottom: 16px; }
  </style>

  <!-- é¢„åº”ç”¨ä¸»é¢˜ï¼Œé˜²é—ªçƒ -->
  <script>
    (function(){
      try{
        var pref = localStorage.getItem('qiqi.theme') || 'auto';
        var d = document.documentElement;
        if(pref==='dark') d.classList.add('force-dark');
        if(pref==='light') d.classList.add('force-light');
      }catch(e){}
    })();
  </script>
</head>

<body>
$for(include-before)$ $include-before$ $endfor$

<header class="page-header">
  $if(title)$<h1 class="title">$title$</h1>$endif$
  $if(subtitle)$<p class="subtitle">$subtitle$</p>$endif$
  $if(author)$<p class="author">$for(author)$$author$$sep$ Â· $endfor$</p>$endif$
  $if(date)$<p class="date">$date$</p>$endif$
</header>

<!-- TOC æŠ½å±‰ï¼ˆåªæœ‰ä¸€ä¸ªï¼‰ -->
$if(toc)$
  <aside id="toc-drawer" aria-label="Table of contents" aria-hidden="true">
    <div class="toc-header">
      <strong>$if(toc-title)$$toc-title$$else$Table of Contents$endif$</strong>
      <button class="toc-close" type="button" aria-label="å…³é—­">Ã—</button>
    </div>
    $table-of-contents$
  </aside>
  <div id="toc-backdrop" hidden></div>
  <button id="btn-toc" class="btn-fab" type="button" aria-controls="toc-drawer" aria-expanded="false">â˜° ç›®å½•</button>
$endif$

<!-- ä¸»é¢˜å¼€å…³ï¼ˆä¸€ä¸ªï¼‰ -->
<button id="btn-theme" class="btn-fab" type="button" aria-live="polite">ğŸŒ“ è‡ªåŠ¨</button>

<main id="write" class="content">
  $body$
</main>

<footer class="page-footer">$if(footer)$ $footer$ $endif$</footer>

$for(include-after)$ $include-after$ $endfor$
$if(math)$ $math$ $endif$

<!-- è¡Œä¸ºè„šæœ¬ï¼šTOC æŠ½å±‰ + ä¸»é¢˜ -->
<script>
(function(){ // TOC
  var btn = document.getElementById('btn-toc');
  var drawer = document.getElementById('toc-drawer');
  var closeBtn = drawer ? drawer.querySelector('.toc-close') : null;
  var backdrop = document.getElementById('toc-backdrop');
  if(!drawer || !btn) return;

  function open(){
    document.body.classList.add('toc-open');
    btn.setAttribute('aria-expanded','true');
    drawer.setAttribute('aria-hidden','false');
    backdrop.hidden = false;
  }
  function close(){
    document.body.classList.remove('toc-open');
    btn.setAttribute('aria-expanded','false');
    drawer.setAttribute('aria-hidden','true');
    backdrop.hidden = true;
  }
  function toggle(){ (document.body.classList.contains('toc-open') ? close : open)(); }

  btn.addEventListener('click', toggle);
  closeBtn && closeBtn.addEventListener('click', close);
  backdrop && backdrop.addEventListener('click', close);
  document.addEventListener('keydown', function(e){
    if(e.key==='Escape') close();
    if(e.key && e.key.toLowerCase()==='t') toggle();
  });
  // ç§»åŠ¨ç«¯ï¼šç‚¹ç›®å½•é¡¹åæ”¶èµ·
  var toc = document.getElementById('TOC');
  if(toc){
    toc.addEventListener('click', function(e){
      if(e.target.closest('a') && window.matchMedia('(max-width:1100px)').matches){ setTimeout(close, 80); }
    });
  }
})();

(function(){ // Theme
  var KEY='qiqi.theme', mql=window.matchMedia('(prefers-color-scheme: dark)');
  var btn=document.getElementById('btn-theme');
  function get(){ try{return localStorage.getItem(KEY)||'auto';}catch(e){return 'auto';} }
  function set(v){ try{localStorage.setItem(KEY,v);}catch(e){} }
  function apply(v){
    var d=document.documentElement; d.classList.remove('force-dark','force-light');
    if(v==='dark') d.classList.add('force-dark');
    if(v==='light') d.classList.add('force-light');
    if(btn){ btn.textContent = v==='auto' ? (mql.matches?'ğŸŒ“ è‡ªåŠ¨Â·æ·±è‰²':'ğŸŒ“ è‡ªåŠ¨Â·æµ…è‰²') : (v==='dark'?'ğŸŒ™ æ·±è‰²':'â˜€ï¸ æµ…è‰²'); }
  }
  function cycle(){ var v=get(); v = (v==='auto')?'dark':(v==='dark'?'light':'auto'); set(v); apply(v); }
  apply(get());
  mql.addEventListener && mql.addEventListener('change', function(){ if(get()==='auto') apply('auto'); });
  btn && btn.addEventListener('click', cycle);
  document.addEventListener('keydown', function(e){
    if(e.target && /input|textarea|select/i.test(e.target.tagName)) return;
    if(e.key && e.key.toLowerCase()==='d') cycle();
  });
})();
</script>
</body>
</html>
